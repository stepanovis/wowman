# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ Telegram-–±–æ—Ç–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∂–µ–Ω—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#1-–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#2-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
3. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#3-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#4-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
5. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#5-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
6. [–ö–æ–º–∞–Ω–¥—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è](#6-–∫–æ–º–∞–Ω–¥—ã-–∏-—Å—Ü–µ–Ω–∞—Ä–∏–∏-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
7. [–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø–µ—Ä–∏–æ–¥–æ–≤ —Ü–∏–∫–ª–∞](#7-–ª–æ–≥–∏–∫–∞-—Ä–∞—Å—á–µ—Ç–∞-–ø–µ—Ä–∏–æ–¥–æ–≤-—Ü–∏–∫–ª–∞)
8. [–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#8-—Å–∏—Å—Ç–µ–º–∞-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
9. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#9-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
10. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#10-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
11. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é](#11-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é)
12. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å](#12-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å)

---

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### 1.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Telegram-–±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∂–µ–Ω—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –ø–∞—Ä, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö —Ü–∏–∫–ª–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—à–∏.

### 1.2 –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è

–ü–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ:
- –í–µ–¥—É—Ç —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –∑–∞–±–æ—Ç—É –æ –∑–¥–æ—Ä–æ–≤—å–µ
- –ü–ª–∞–Ω–∏—Ä—É—é—Ç –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –•–æ—Ç—è—Ç –±—ã—Ç—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∫ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º –ø–∞—Ä—Ç–Ω–µ—Ä—à–∏

### 1.3 –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- –ó–∞–±–æ—Ç–ª–∏–≤—ã–π –∏ –¥–µ–ª–∏–∫–∞—Ç–Ω—ã–π —Ç–æ–Ω –æ–±—â–µ–Ω–∏—è
- –ù–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

---

## 2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 2.1 –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

1. **–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
   - –§–æ—Ä–º–∞—Ç: DD.MM.YYYY
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ –ø–æ–∑–¥–Ω–µ–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã, –Ω–µ —Ä–∞–Ω–µ–µ 90 –¥–Ω–µ–π –Ω–∞–∑–∞–¥

2. **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞** (–¥–Ω–µ–π)
   - –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 28 –¥–Ω–µ–π
   - –î–∏–∞–ø–∞–∑–æ–Ω: 21-35 –¥–Ω–µ–π
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

3. **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ—Å—è—á–Ω—ã—Ö** (–¥–Ω–µ–π)
   - –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5 –¥–Ω–µ–π
   - –î–∏–∞–ø–∞–∑–æ–Ω: 3-7 –¥–Ω–µ–π
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 2.2 –¢–∏–ø—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 5 —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

1. **–ù–∞—á–∞–ª–æ –æ–≤—É–ª—è—Ü–∏–∏** (–∑–∞ 1 –¥–µ–Ω—å –¥–æ —Ä–∞—Å—á–µ—Ç–Ω–æ–π –æ–≤—É–ª—è—Ü–∏–∏)
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –¥–µ–ª–∞—Ç—å —Ä–µ–±–µ–Ω–æ—á–∫–∞ üë∂"
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–º –ø–µ—Ä–∏–æ–¥–µ

2. **–ó–æ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–µ–∫—Å–∞** (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–≤—É–ª—è—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞)
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –Ω–∞—á–∞–ª–∞—Å—å –∑–æ–Ω–∞ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–µ–∫—Å–∞ üíö"
   - –£–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∑–∞—á–∞—Ç–∏—è

3. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 3 –¥–Ω—è**
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–ß–µ—Ä–µ–∑ –ø–∞—Ä—É –¥–Ω–µ–π –Ω–∞—á–Ω—É—Ç—Å—è –º–µ—Å—è—á–Ω—ã–µ, –ø–æ–∑–∞–±–æ—Ç—å—Å—è –æ —Å–≤–æ–µ–π –ª—é–±–∏–º–æ–π üíù"
   - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–±–æ—Ç–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ

4. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 1 –¥–µ–Ω—å**
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–ó–∞–≤—Ç—Ä–∞ –º–µ—Å—è—á–Ω—ã–µ üìÖ"
   - –§–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ

5. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞** (–≤ –æ–∂–∏–¥–∞–µ–º—ã–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞)
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–°–µ–≥–æ–¥–Ω—è –Ω–∞—á–∞–ª–∏—Å—å –º–µ—Å—è—á–Ω—ã–µ?"
   - –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞: "–î–∞", "–í—á–µ—Ä–∞", "–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É"

### 2.3 –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö:
- –ü–µ—Ä–µ—Å—á–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü–∏–∫–ª–∞ —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## 3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### 3.1 –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è**: Python 3.11+
- **Telegram Bot Framework**: python-telegram-bot 20.x
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL 15+
- **ORM**: SQLAlchemy 2.x
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á**: APScheduler
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker + Docker Compose
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π**: python-dotenv

### 3.2 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- `psycopg2-binary` - –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- `pytz` - —Ä–∞–±–æ—Ç–∞ —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏
- `pydantic` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `alembic` - –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

---

## 4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 4.1 –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram API  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Bot Handler Layer       ‚îÇ
‚îÇ  (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏        ‚îÇ
‚îÇ   callback'–æ–≤)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Business Logic Layer      ‚îÇ
‚îÇ  - –†–∞—Å—á–µ—Ç –ø–µ—Ä–∏–æ–¥–æ–≤          ‚îÇ
‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö         ‚îÇ
‚îÇ  - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Data Access Layer (ORM)   ‚îÇ
‚îÇ  - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏            ‚îÇ
‚îÇ  - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL Database       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

         ‚ïë (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Notification Scheduler     ‚îÇ
‚îÇ  (APScheduler)              ‚îÇ
‚îÇ  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö     ‚îÇ
‚îÇ    —Å–æ–±—ã—Ç–∏–π                  ‚îÇ
‚îÇ  - –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4.2 –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

#### 4.2.1 Bot Module (`bot/`)
- `handlers.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- `keyboards.py` - inline –∏ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- `messages.py` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- `states.py` - —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è ConversationHandler

#### 4.2.2 Core Module (`core/`)
- `calculator.py` - —Ä–∞—Å—á–µ—Ç –ø–µ—Ä–∏–æ–¥–æ–≤ —Ü–∏–∫–ª–∞
- `validator.py` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- `notifier.py` - –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `scheduler.py` - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á

#### 4.2.3 Database Module (`database/`)
- `models.py` - SQLAlchemy –º–æ–¥–µ–ª–∏
- `crud.py` - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- `connection.py` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

#### 4.2.4 Config Module (`config/`)
- `settings.py` - –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `constants.py` - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 5.1 –¢–∞–±–ª–∏—Ü–∞ `users`

–•—Ä–∞–Ω–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

```sql
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    timezone VARCHAR(50) DEFAULT 'UTC'
);

CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_is_active ON users(is_active);
```

### 5.2 –¢–∞–±–ª–∏—Ü–∞ `cycle_settings`

–•—Ä–∞–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–∏–∫–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```sql
CREATE TABLE cycle_settings (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    cycle_length INTEGER NOT NULL DEFAULT 28,
    period_length INTEGER NOT NULL DEFAULT 5,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT cycle_length_check CHECK (cycle_length BETWEEN 21 AND 35),
    CONSTRAINT period_length_check CHECK (period_length BETWEEN 3 AND 7),
    CONSTRAINT user_id_unique UNIQUE (user_id)
);

CREATE INDEX idx_cycle_settings_user_id ON cycle_settings(user_id);
```

### 5.3 –¢–∞–±–ª–∏—Ü–∞ `cycle_records`

–•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ü–∏–∫–ª–æ–≤ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤.

```sql
CREATE TABLE cycle_records (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    start_date DATE NOT NULL,
    end_date DATE,
    is_confirmed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_cycle_records_user_id ON cycle_records(user_id);
CREATE INDEX idx_cycle_records_start_date ON cycle_records(start_date);
CREATE INDEX idx_cycle_records_is_confirmed ON cycle_records(is_confirmed);
```

### 5.4 –¢–∞–±–ª–∏—Ü–∞ `notifications`

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–µ–π).

```sql
CREATE TABLE notifications (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    notification_type VARCHAR(50) NOT NULL,
    scheduled_date DATE NOT NULL,
    sent_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT unique_notification UNIQUE (user_id, notification_type, scheduled_date)
);

CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_scheduled_date ON notifications(scheduled_date);
```

### 5.5 –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```python
# –í –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class NotificationType(str, Enum):
    OVULATION_START = "ovulation_start"
    SAFE_ZONE_START = "safe_zone_start"
    PERIOD_IN_3_DAYS = "period_in_3_days"
    PERIOD_TOMORROW = "period_tomorrow"
    PERIOD_CONFIRMATION = "period_confirmation"
```

---

## 6. –ö–æ–º–∞–Ω–¥—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### 6.1 –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### 6.1.1 `/start`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –Ω–∞—á–∞–ª–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
2. –ï—Å–ª–∏ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–µ—Ä–≤–∏—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–º–µ–Ω–µ–º
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é

**–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**:
```
–ü—Ä–∏–≤–µ—Ç! üëã

–Ø –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∑–∞–±–æ—Ç—ã –æ –≤–∞—à–µ–π –ø–∞—Ä–µ.

–ú–æ—è —Ü–µ–ª—å ‚Äî –ø–æ–º–æ—á—å –≤–∞–º –±—ã—Ç—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º–∏ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É, –Ω–∞–ø–æ–º–∏–Ω–∞—è –æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö –∂–µ–Ω—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º:

üíö –õ—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞—à–µ–π –ø–∞—Ä—Ç–Ω–µ—Ä—à–∏
üíù –ü—Ä–æ—è–≤–ª—è—Ç—å –∑–∞–±–æ—Ç—É –≤ –Ω—É–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã
üë∂ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞—á–∞—Ç–∏–µ –∏–ª–∏ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ
ü§ù –£–∫—Ä–µ–ø–ª—è—Ç—å –¥–æ–≤–µ—Ä–∏–µ –∏ –±–ª–∏–∑–æ—Å—Ç—å –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö

–Ø –±—É–¥—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ:
‚Ä¢ –ü–µ—Ä–∏–æ–¥–µ –æ–≤—É–ª—è—Ü–∏–∏ (–¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏)
‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –¥–Ω—è—Ö —Ü–∏–∫–ª–∞
‚Ä¢ –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –º–µ—Å—è—á–Ω—ã—Ö

–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–≥–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã –∏ –∑–∞—â–∏—â–µ–Ω—ã.

–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É! üå∏
```

#### 6.1.2 `/setup`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏/–ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ü–∏–∫–ª–∞.

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
1. –ó–∞–ø—Ä–æ—Å –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö
2. –ó–∞–ø—Ä–æ—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ü–∏–∫–ª–∞ (—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. –ó–∞–ø—Ä–æ—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–µ—Å—è—á–Ω—ã—Ö (—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
5. –†–∞—Å—á–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –≤–∞–∂–Ω—ã—Ö –¥–∞—Ç

**–ü–æ—à–∞–≥–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**:

**–®–∞–≥ 1**: –ó–∞–ø—Ä–æ—Å –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö
```
–ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∏—Å—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–µ—Å—è—á–Ω—ã–µ? üìÖ

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì
–ù–∞–ø—Ä–∏–º–µ—Ä: 15.09.2025
```

**–®–∞–≥ 2**: –ó–∞–ø—Ä–æ—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ü–∏–∫–ª–∞
```
–ö–∞–∫–æ–≤–∞ –æ–±—ã—á–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞? üîÑ

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî 28 –¥–Ω–µ–π.
–í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–µ (–æ—Ç 21 –¥–æ 35 –¥–Ω–µ–π).

[–ö–Ω–æ–ø–∫–∞: –û—Å—Ç–∞–≤–∏—Ç—å 28 –¥–Ω–µ–π] [–í–≤–µ—Å—Ç–∏ —Å–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ]
```

**–®–∞–≥ 3**: –ó–∞–ø—Ä–æ—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–µ—Å—è—á–Ω—ã—Ö
```
–ö–∞–∫–æ–≤–∞ –æ–±—ã—á–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ—Å—è—á–Ω—ã—Ö? üå∏

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî 5 –¥–Ω–µ–π.
–í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–µ (–æ—Ç 3 –¥–æ 7 –¥–Ω–µ–π).

[–ö–Ω–æ–ø–∫–∞: –û—Å—Ç–∞–≤–∏—Ç—å 5 –¥–Ω–µ–π] [–í–≤–µ—Å—Ç–∏ —Å–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ]
```

**–®–∞–≥ 4**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```
–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

üìÖ –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö: 15.09.2025
üîÑ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞: 28 –¥–Ω–µ–π
üå∏ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ—Å—è—á–Ω—ã—Ö: 5 –¥–Ω–µ–π

–í—Å–µ –≤–µ—Ä–Ω–æ?

[–î–∞, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å] [–ò–∑–º–µ–Ω–∏—Ç—å]
```

**–®–∞–≥ 5**: –£—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
```
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! ‚úÖ

–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö:

üë∂ –û–≤—É–ª—è—Ü–∏—è –æ–∂–∏–¥–∞–µ—Ç—Å—è: ~26.09.2025
üíö –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –Ω–∞—á–Ω–µ—Ç—Å—è: ~29.09.2025
üìÖ –°–ª–µ–¥—É—é—â–∏–µ –º–µ—Å—è—á–Ω—ã–µ: ~13.10.2025

–Ø –±—É–¥—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã.
–ñ–µ–ª–∞—é –≤–∞–º –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –∑–∞–±–æ—Ç—ã! üíù
```

#### 6.1.3 `/calendar`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Ç–µ–∫—É—â–µ–≥–æ –∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–æ–≤.

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**:
```
–ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤–∞—à–µ–≥–æ —Ü–∏–∫–ª–∞ üìÖ

–¢–ï–ö–£–©–ò–ô –¶–ò–ö–õ:
–ù–∞—á–∞–ª–æ: 15.09.2025
–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–µ—Å—è—á–Ω—ã—Ö: ~19.09.2025
–û–≤—É–ª—è—Ü–∏—è: ~26.09.2025 (24-28.09)
–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–∏–æ–¥: —Å 29.09.2025

–°–õ–ï–î–£–Æ–©–ò–ô –¶–ò–ö–õ:
–û–∂–∏–¥–∞–µ–º–æ–µ –Ω–∞—á–∞–ª–æ: 13.10.2025

[–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ]
```

#### 6.1.4 `/settings`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–æ—Ç–∞.

**–û–ø—Ü–∏–∏**:
- –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü–∏–∫–ª–∞
- –û—Ç–∫–ª—é—á–∏—Ç—å/–≤–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**:
```
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚öôÔ∏è

–í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
üîÑ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞: 28 –¥–Ω–µ–π
üå∏ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ—Å—è—á–Ω—ã—Ö: 5 –¥–Ω–µ–π
üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –≤–∫–ª—é—á–µ–Ω—ã

[–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü–∏–∫–ª–∞]
[–û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è]
[–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –º–æ–∏ –¥–∞–Ω–Ω—ã–µ]
[–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é]
```

#### 6.1.5 `/help`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞.

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**:
```
–ü–æ–º–æ—â—å üìñ

–ö–ê–ö –ü–û–õ–¨–ó–û–í–ê–¢–¨–°–Ø –ë–û–¢–û–ú:

/start ‚Äî –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/setup ‚Äî –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü–∏–∫–ª–∞
/calendar ‚Äî –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Ü–∏–∫–ª–æ–≤
/settings ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
/help ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

–ß–¢–û –î–ï–õ–ê–ï–¢ –ë–û–¢:

üí° –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∂–µ–Ω—Å–∫–∏–π —Ü–∏–∫–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
üì¨ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö
üîí –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–¢–ò–ü–´ –£–í–ï–î–û–ú–õ–ï–ù–ò–ô:

üë∂ –ü–µ—Ä–∏–æ–¥ –æ–≤—É–ª—è—Ü–∏–∏ (–¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
üíö –ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
üíù –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 3 –¥–Ω—è –¥–æ –º–µ—Å—è—á–Ω—ã—Ö
üìÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 1 –¥–µ–Ω—å
‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∞–ª–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–ø–∏—à–∏—Ç–µ @support_username
```

### 6.2 –°—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö

**–¢—Ä–∏–≥–≥–µ—Ä**: –í —Ä–∞—Å—á–µ—Ç–Ω—ã–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö (–≤ 09:00 –ø–æ —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

**–°–æ–æ–±—â–µ–Ω–∏–µ**:
```
–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! ‚òÄÔ∏è

–°–µ–≥–æ–¥–Ω—è –æ–∂–∏–¥–∞–µ—Ç—Å—è –Ω–∞—á–∞–ª–æ –º–µ—Å—è—á–Ω—ã—Ö.
–û–Ω–∏ —É–∂–µ –Ω–∞—á–∞–ª–∏—Å—å? üå∏

[–î–∞, —Å–µ–≥–æ–¥–Ω—è] [–í—á–µ—Ä–∞] [–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É] [–ï—â–µ –Ω–µ—Ç]
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤**:

1. **"–î–∞, —Å–µ–≥–æ–¥–Ω—è"**:
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ —Ü–∏–∫–ª–∞ —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π
   - –ü–µ—Ä–µ—Å—á–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: "–°–ø–∞—Å–∏–±–æ! –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã. –°–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª –æ–∂–∏–¥–∞–µ—Ç—Å—è 10.11.2025."

2. **"–í—á–µ—Ä–∞"**:
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å –¥–∞—Ç–æ–π –≤—á–µ—Ä–∞
   - –ü–µ—Ä–µ—Å—á–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: "–°–ø–∞—Å–∏–±–æ! –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã."

3. **"–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É"**:
   - –ó–∞–ø—Ä–æ—Å –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì
   - –í–∞–ª–∏–¥–∞—Ü–∏—è (–Ω–µ –±–æ–ª–µ–µ 5 –¥–Ω–µ–π –Ω–∞–∑–∞–¥/–≤–ø–µ—Ä–µ–¥)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Å—á–µ—Ç

4. **"–ï—â–µ –Ω–µ—Ç"**:
   - –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
   - "–•–æ—Ä–æ—à–æ, —è –Ω–∞–ø–æ–º–Ω—é –∑–∞–≤—Ç—Ä–∞!"

### 6.3 –°—Ü–µ–Ω–∞—Ä–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ü–∏–∫–ª–∞

–ï—Å–ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ä–∞—Å—á–µ—Ç–Ω–æ–π –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 2 –¥–Ω—è, –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```
–ó–∞–º–µ—Ç–∏–ª, —á—Ç–æ –º–µ—Å—è—á–Ω—ã–µ –Ω–∞—á–∞–ª–∏—Å—å –Ω–∞ 3 –¥–Ω—è —Ä–∞–Ω—å—à–µ, —á–µ–º –æ–∂–∏–¥–∞–ª–æ—Å—å.

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–ª –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤?

–¢–µ–∫—É—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 28 –¥–Ω–µ–π
–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ: 25 –¥–Ω–µ–π

[–î–∞, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] [–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å]
```

---

## 7. –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø–µ—Ä–∏–æ–¥–æ–≤ —Ü–∏–∫–ª–∞

### 7.1 –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã

#### 7.1.1 –ú–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏—è
- **–ù–∞—á–∞–ª–æ**: –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö
- **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `period_length`
- **–ö–æ–Ω–µ—Ü**: `start_date + period_length - 1`

#### 7.1.2 –§–æ–ª–ª–∏–∫—É–ª—è—Ä–Ω–∞—è —Ñ–∞–∑–∞
- **–ù–∞—á–∞–ª–æ**: –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏
- **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –¥–æ –æ–≤—É–ª—è—Ü–∏–∏

#### 7.1.3 –û–≤—É–ª—è—Ü–∏—è
- **–†–∞—Å—á–µ—Ç–Ω—ã–π –¥–µ–Ω—å**: `start_date + cycle_length - 14`
- **–û–∫–Ω–æ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ—Å—Ç–∏**: 5 –¥–Ω–µ–π (2 –¥–Ω—è –¥–æ –æ–≤—É–ª—è—Ü–∏–∏ + –¥–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏ + 2 –¥–Ω—è –ø–æ—Å–ª–µ)
- **–§–æ—Ä–º—É–ª–∞ –æ–∫–Ω–∞**: `[ovulation_day - 2, ovulation_day + 2]`

#### 7.1.4 –õ—é—Ç–µ–∏–Ω–æ–≤–∞—è —Ñ–∞–∑–∞ (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–∏–æ–¥)
- **–ù–∞—á–∞–ª–æ**: `ovulation_day + 3`
- **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –¥–æ –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞

#### 7.1.5 –°–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª
- **–†–∞—Å—á–µ—Ç–Ω–∞—è –¥–∞—Ç–∞**: `start_date + cycle_length`

### 7.2 –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞

```python
from datetime import datetime, timedelta
from typing import Tuple

def calculate_cycle_periods(
    last_period_date: datetime,
    cycle_length: int,
    period_length: int
) -> dict:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–∏–æ–¥—ã —Ü–∏–∫–ª–∞.

    Args:
        last_period_date: –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö
        cycle_length: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ (–¥–Ω–µ–π)
        period_length: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ—Å—è—á–Ω—ã—Ö (–¥–Ω–µ–π)

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–µ–≤—ã–º–∏ –¥–∞—Ç–∞–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏
    """

    # –û–∫–æ–Ω—á–∞–Ω–∏–µ –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏
    period_end_date = last_period_date + timedelta(days=period_length - 1)

    # –î–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏ (–∑–∞ 14 –¥–Ω–µ–π –¥–æ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö)
    ovulation_day = last_period_date + timedelta(days=cycle_length - 14)

    # –û–∫–Ω–æ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (5 –¥–Ω–µ–π)
    fertile_window_start = ovulation_day - timedelta(days=2)
    fertile_window_end = ovulation_day + timedelta(days=2)

    # –ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
    safe_period_start = fertile_window_end + timedelta(days=1)

    # –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞
    next_period_date = last_period_date + timedelta(days=cycle_length)

    # –î–∞—Ç—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    notification_3_days_before = next_period_date - timedelta(days=3)
    notification_1_day_before = next_period_date - timedelta(days=1)
    notification_ovulation = ovulation_day - timedelta(days=1)

    return {
        "period_start": last_period_date,
        "period_end": period_end_date,
        "ovulation_day": ovulation_day,
        "fertile_window_start": fertile_window_start,
        "fertile_window_end": fertile_window_end,
        "safe_period_start": safe_period_start,
        "next_period_date": next_period_date,
        "notifications": {
            "ovulation_alert": notification_ovulation,
            "safe_zone_alert": safe_period_start,
            "period_3_days": notification_3_days_before,
            "period_1_day": notification_1_day_before,
            "period_confirmation": next_period_date
        }
    }
```

### 7.3 –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏

–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3-6 –∑–∞–ø–∏—Å–µ–π:

```python
def calculate_average_cycle_length(user_id: int, records_count: int = 3) -> int:
    """
    –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥–Ω—é—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏.

    Args:
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        records_count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ü–∏–∫–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

    Returns:
        –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ (–¥–Ω–µ–π)
    """
    # –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
    records = get_confirmed_cycle_records(user_id, limit=records_count)

    if len(records) < 2:
        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
        return get_user_default_cycle_length(user_id)

    cycle_lengths = []
    for i in range(len(records) - 1):
        current = records[i].start_date
        previous = records[i + 1].start_date
        length = (current - previous).days
        cycle_lengths.append(length)

    # –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º
    average_length = round(sum(cycle_lengths) / len(cycle_lengths))

    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã (21-35 –¥–Ω–µ–π)
    return max(21, min(35, average_length))
```

---

## 8. –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 8.1 –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∏—Ö —Ç–µ–∫—Å—Ç—ã

#### 8.1.1 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–≤—É–ª—è—Ü–∏–∏ (–∑–∞ 1 –¥–µ–Ω—å)

**–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏**: 20:00

```
–ü—Ä–∏–≤–µ—Ç! üëã

–ó–∞–≤—Ç—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥ –æ–≤—É–ª—è—Ü–∏–∏ ‚Äî —Å–∞–º–æ–µ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∑–∞—á–∞—Ç–∏—è. üë∂

–ï—Å–ª–∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ä–µ–±–µ–Ω–æ—á–∫–∞, —Å–ª–µ–¥—É—é—â–∏–µ 3-4 –¥–Ω—è –±—É–¥—É—Ç –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã–º–∏.

–ó–∞–±–æ—Ç—å—Ç–µ—Å—å –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ! üíù
```

#### 8.1.2 –ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞

**–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏**: 09:00

```
–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! ‚òÄÔ∏è

–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –Ω–∞—á–∞–ª–∞—Å—å –∑–æ–Ω–∞ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–µ–∫—Å–∞. üíö

–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∑–∞—á–∞—Ç–∏—è —Å–µ–π—á–∞—Å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–µ–Ω–∞, –Ω–æ –ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –Ω–∏ –æ–¥–∏–Ω –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –Ω–µ –¥–∞–µ—Ç 100% –≥–∞—Ä–∞–Ω—Ç–∏–∏.

–ë—É–¥—å—Ç–µ —Å—á–∞—Å—Ç–ª–∏–≤—ã! üòä
```

#### 8.1.3 –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 3 –¥–Ω—è

**–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏**: 18:00

```
–ü—Ä–∏–≤–µ—Ç! üëã

–ß–µ—Ä–µ–∑ –ø–∞—Ä—É –¥–Ω–µ–π –Ω–∞—á–Ω—É—Ç—Å—è –º–µ—Å—è—á–Ω—ã–µ. üå∏

–°–µ–π—á–∞—Å —Å–∞–º–æ–µ –≤—Ä–µ–º—è –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–≤–æ–µ–π –ª—é–±–∏–º–æ–π:
‚Ä¢ –ó–∞–ø–∞—Å—Ç–∏—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –≥–∏–≥–∏–µ–Ω—ã
‚Ä¢ –ë—ã—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º –∏ –Ω–µ–∂–Ω—ã–º
‚Ä¢ –ü—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω–æ–µ –∏–ª–∏ —É–¥–∏–≤–∏—Ç—å –ø—Ä–∏—è—Ç–Ω—ã–º —Å—é—Ä–ø—Ä–∏–∑–æ–º

–ó–∞–±–æ—Ç–∞ –≤ —Ç–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –æ—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω–Ω–∞! üíù
```

#### 8.1.4 –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 1 –¥–µ–Ω—å

**–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏**: 20:00

```
–ù–∞–ø–æ–º–∏–Ω–∞—é: –∑–∞–≤—Ç—Ä–∞ –º–µ—Å—è—á–Ω—ã–µ. üìÖ

–ë—É–¥—å—Ç–µ —Ä—è–¥–æ–º –∏ –∑–∞–±–æ—Ç—å—Ç–µ—Å—å –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ! üíö
```

#### 8.1.5 –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ (—Å–º. —Ä–∞–∑–¥–µ–ª 6.2)

**–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏**: 09:00

### 8.2 –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

#### 8.2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è APScheduler —Å PostgreSQL –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∑–∞–¥–∞—á –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore
from pytz import utc

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
jobstores = {
    'default': SQLAlchemyJobStore(url='postgresql://...')
}

scheduler = AsyncIOScheduler(jobstores=jobstores, timezone=utc)
```

#### 8.2.2 –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∞:

```python
def schedule_notifications_for_user(user_id: int):
    """
    –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    # –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–µ—Ä–∏–æ–¥—ã
    user_data = get_user_cycle_data(user_id)
    periods = calculate_cycle_periods(
        user_data.last_period_date,
        user_data.cycle_length,
        user_data.period_length
    )

    # –ü–æ–ª—É—á–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    tz = get_user_timezone(user_id)

    # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    remove_user_jobs(user_id)

    # –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    notifications = periods["notifications"]

    # 1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–≤—É–ª—è—Ü–∏–∏ (20:00)
    scheduler.add_job(
        send_ovulation_notification,
        'date',
        run_date=notifications["ovulation_alert"].replace(hour=20, tzinfo=tz),
        args=[user_id],
        id=f'ovulation_{user_id}',
        replace_existing=True
    )

    # 2. –ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (09:00)
    scheduler.add_job(
        send_safe_zone_notification,
        'date',
        run_date=notifications["safe_zone_alert"].replace(hour=9, tzinfo=tz),
        args=[user_id],
        id=f'safe_zone_{user_id}',
        replace_existing=True
    )

    # 3. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 3 –¥–Ω—è (18:00)
    scheduler.add_job(
        send_period_in_3_days_notification,
        'date',
        run_date=notifications["period_3_days"].replace(hour=18, tzinfo=tz),
        args=[user_id],
        id=f'period_3days_{user_id}',
        replace_existing=True
    )

    # 4. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 1 –¥–µ–Ω—å (20:00)
    scheduler.add_job(
        send_period_tomorrow_notification,
        'date',
        run_date=notifications["period_1_day"].replace(hour=20, tzinfo=tz),
        args=[user_id],
        id=f'period_1day_{user_id}',
        replace_existing=True
    )

    # 5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ (09:00)
    scheduler.add_job(
        send_period_confirmation_request,
        'date',
        run_date=notifications["period_confirmation"].replace(hour=9, tzinfo=tz),
        args=[user_id],
        id=f'period_confirm_{user_id}',
        replace_existing=True
    )
```

#### 8.2.3 –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `notifications`:

```python
async def send_notification_if_not_sent(
    user_id: int,
    notification_type: str,
    scheduled_date: datetime
):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ –µ—â–µ –Ω–µ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
    already_sent = check_notification_sent(
        user_id,
        notification_type,
        scheduled_date.date()
    )

    if already_sent:
        return

    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    await send_notification(user_id, notification_type)

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î
    log_notification(user_id, notification_type, scheduled_date.date())
```

---

## 9. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 9.1 –§–∞–π–ª `.env`

```env
# Telegram Bot Configuration
BOT_TOKEN=your_bot_token_here
BOT_ID=your_bot_id_here

# Database Configuration
DB_HOST=postgres
DB_PORT=5432
DB_NAME=ovulo_db
DB_USER=ovulo_user
DB_PASSWORD=your_secure_password_here

# Application Settings
TIMEZONE=Europe/Moscow
LOG_LEVEL=INFO
ENVIRONMENT=production

# Notification Settings
DEFAULT_CYCLE_LENGTH=28
DEFAULT_PERIOD_LENGTH=5
MIN_CYCLE_LENGTH=21
MAX_CYCLE_LENGTH=35
MIN_PERIOD_LENGTH=3
MAX_PERIOD_LENGTH=7

# Feature Flags
ENABLE_NOTIFICATIONS=true
ENABLE_AUTO_CORRECTION=true
```

### 9.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `config/settings.py`

```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # Bot settings
    bot_token: str
    bot_id: str

    # Database settings
    db_host: str
    db_port: int = 5432
    db_name: str
    db_user: str
    db_password: str

    # Application settings
    timezone: str = "UTC"
    log_level: str = "INFO"
    environment: str = "production"

    # Cycle defaults
    default_cycle_length: int = 28
    default_period_length: int = 5
    min_cycle_length: int = 21
    max_cycle_length: int = 35
    min_period_length: int = 3
    max_period_length: int = 7

    # Feature flags
    enable_notifications: bool = True
    enable_auto_correction: bool = True

    @property
    def database_url(self) -> str:
        return (
            f"postgresql://{self.db_user}:{self.db_password}"
            f"@{self.db_host}:{self.db_port}/{self.db_name}"
        )

    class Config:
        env_file = ".env"
        case_sensitive = False

settings = Settings()
```

---

## 10. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ovulo/
‚îÇ
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py          # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (inline –∏ reply)
‚îÇ   ‚îú‚îÄ‚îÄ messages.py           # –¢–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ states.py             # –°–æ—Å—Ç–æ—è–Ω–∏—è ConversationHandler
‚îÇ
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ calculator.py         # –†–∞—Å—á–µ—Ç –ø–µ—Ä–∏–æ–¥–æ–≤ —Ü–∏–∫–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ validator.py          # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ notifier.py           # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ scheduler.py          # –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
‚îÇ
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models.py             # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ crud.py               # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ connection.py         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ migrations/           # Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ env.py
‚îÇ       ‚îú‚îÄ‚îÄ script.py.mako
‚îÇ       ‚îî‚îÄ‚îÄ versions/
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ constants.py          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_calculator.py
‚îÇ   ‚îú‚îÄ‚îÄ test_validator.py
‚îÇ   ‚îú‚îÄ‚îÄ test_handlers.py
‚îÇ   ‚îî‚îÄ‚îÄ test_crud.py
‚îÇ
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ init_db.py            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ create_migration.py   # –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ alembic.ini
‚îú‚îÄ‚îÄ main.py                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ README.md
```

---

## 11. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### 11.1 Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª `docker/docker-compose.yml`**:

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: ovulo_postgres
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USER}"]
      interval: 10s
      timeout: 5s
      retries: 5

  bot:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: ovulo_bot
    env_file:
      - ../.env
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped
    volumes:
      - ../logs:/app/logs
    command: python main.py

volumes:
  postgres_data:
```

### 11.2 Dockerfile

**–§–∞–π–ª `docker/Dockerfile`**:

```dockerfile
FROM python:3.11-slim

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
WORKDIR /app

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
RUN mkdir -p /app/logs

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
CMD ["python", "main.py"]
```

### 11.3 Requirements.txt

```txt
python-telegram-bot==20.7
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
alembic==1.12.1
pydantic==2.5.2
pydantic-settings==2.1.0
python-dotenv==1.0.0
APScheduler==3.10.4
pytz==2023.3
```

### 11.4 –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

#### 11.4.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker –∏ Docker Compose:
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
```

2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository_url>
cd ovulo
```

3. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```bash
cp .env.example .env
nano .env  # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```

#### 11.4.2 –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
```bash
docker-compose -f docker/docker-compose.yml up -d
```

2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:
```bash
docker exec -it ovulo_bot alembic upgrade head
```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
```bash
docker-compose -f docker/docker-compose.yml ps
docker logs ovulo_bot
```

#### 11.4.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
git pull origin main
docker-compose -f docker/docker-compose.yml down
docker-compose -f docker/docker-compose.yml build --no-cache
docker-compose -f docker/docker-compose.yml up -d
docker exec -it ovulo_bot alembic upgrade head
```

#### 11.4.4 –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
docker exec -t ovulo_postgres pg_dump -U ovulo_user ovulo_db > backup_$(date +%Y%m%d_%H%M%S).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
docker exec -i ovulo_postgres psql -U ovulo_user ovulo_db < backup_20250930_120000.sql
```

### 11.5 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 11.5.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

```python
import logging
from logging.handlers import RotatingFileHandler

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–≥–µ—Ä–∞
logger = logging.getLogger('ovulo')
logger.setLevel(logging.INFO)

# –§–∞–π–ª–æ–≤—ã–π —Ö–µ–Ω–¥–ª–µ—Ä
file_handler = RotatingFileHandler(
    'logs/bot.log',
    maxBytes=10485760,  # 10MB
    backupCount=5
)
file_handler.setFormatter(
    logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
)

# –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ö–µ–Ω–¥–ª–µ—Ä
console_handler = logging.StreamHandler()
console_handler.setFormatter(
    logging.Formatter('%(levelname)s - %(message)s')
)

logger.addHandler(file_handler)
logger.addHandler(console_handler)
```

#### 11.5.2 –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ø–æ —Ç–∏–ø–∞–º)
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –ë–î
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ CPU –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

## 12. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

### 12.1 –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

1. **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
2. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SSL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
3. **–ò–∑–æ–ª—è—Ü–∏—è**: –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
4. **–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É**: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### 12.2 GDPR-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 12.2.1 –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
def delete_user_data(user_id: int):
    """
    –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
    """
    with db.session() as session:
        # –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è ON DELETE CASCADE
        user = session.query(User).filter_by(telegram_id=user_id).first()
        if user:
            session.delete(user)
            session.commit()
```

#### 12.2.2 –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

```python
def export_user_data(user_id: int) -> dict:
    """
    –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ.
    """
    user = get_user_by_telegram_id(user_id)
    cycle_settings = get_cycle_settings(user.id)
    cycle_records = get_all_cycle_records(user.id)

    return {
        "user_info": {
            "telegram_id": user.telegram_id,
            "created_at": user.created_at.isoformat(),
        },
        "cycle_settings": {
            "cycle_length": cycle_settings.cycle_length,
            "period_length": cycle_settings.period_length,
        },
        "cycle_history": [
            {
                "start_date": record.start_date.isoformat(),
                "is_confirmed": record.is_confirmed
            }
            for record in cycle_records
        ]
    }
```

### 12.3 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env`
2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞**: PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏
3. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### 12.4 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
async def error_handler(update: Update, context: CallbackContext):
    """
    –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫.
    """
    logger.error(f"Update {update} caused error {context.error}")

    # –û—Ç–ø—Ä–∞–≤–∫–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    if update and update.effective_message:
        await update.effective_message.reply_text(
            "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
        )

    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
    if is_critical_error(context.error):
        await notify_admin(context.error)
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram-–±–æ—Ç–∞ –ø–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é –∂–µ–Ω—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**:
1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–π
3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
4. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥
5. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ –ø–µ—Ä–∏–æ–¥–æ–≤
6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
8. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

**–†–∞—Å—á–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: 40-50 —á–∞—Å–æ–≤ —á–∏—Å—Ç–æ–≥–æ –∫–æ–¥–∏–Ω–≥–∞.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ—É–Ω–∫—Ü–∏–π**:
1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, —Ä–∞—Å—á–µ—Ç –ø–µ—Ä–∏–æ–¥–æ–≤, –±–∞–∑–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
2. –í—ã—Å–æ–∫–∏–µ: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ü–∏–∫–ª–∞
3. –°—Ä–µ–¥–Ω–∏–µ: –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. –ù–∏–∑–∫–∏–µ: —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–¥–µ–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---