"""
–ú–æ–¥—É–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.

–°–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã
–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏.
"""

from enum import Enum
from typing import Dict, Optional
from datetime import timedelta


class NotificationType(Enum):
    """–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–æ–º —Ü–∏–∫–ª–µ."""

    PERIOD_REMINDER = "period_reminder"  # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –º–µ—Å—è—á–Ω—ã—Ö
    PERIOD_START = "period_start"  # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –º–µ—Å—è—á–Ω—ã—Ö
    FERTILE_WINDOW_START = "fertile_window_start"  # –ù–∞—á–∞–ª–æ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    OVULATION_DAY = "ovulation_day"  # –î–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏
    SAFE_PERIOD = "safe_period"  # –ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞


# –¢–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
NOTIFICATION_MESSAGES: Dict[NotificationType, str] = {
    NotificationType.PERIOD_REMINDER: (
        "üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ\n\n"
        "–ß–µ—Ä–µ–∑ 2 –¥–Ω—è –Ω–∞—á–Ω—É—Ç—Å—è –º–µ—Å—è—á–Ω—ã–µ.\n"
        "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≥–∏–≥–∏–µ–Ω—ã.\n\n"
        "üíä –ï—Å–ª–∏ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ –ø—Ä–µ–¥–º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã, "
        "—Å–∞–º–æ–µ –≤—Ä–µ–º—è –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–µ–±–µ."
    ),

    NotificationType.PERIOD_START: (
        "ü©∏ –ù–∞—á–∞–ª–æ –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏\n\n"
        "–°–µ–≥–æ–¥–Ω—è –æ–∂–∏–¥–∞–µ–º—ã–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö.\n"
        "–û—Ç–º–µ—Ç—å—Ç–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è.\n\n"
        "üíô –ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –∫ —Å–≤–æ–µ–º—É —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—é –∏ "
        "–Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ—Ç–¥—ã—Ö–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏."
    ),

    NotificationType.FERTILE_WINDOW_START: (
        "üå∏ –ù–∞—á–∞–ª–æ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞\n\n"
        "–°–µ–≥–æ–¥–Ω—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–∞—à–µ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ–µ –æ–∫–Ω–æ.\n"
        "–°–ª–µ–¥—É—é—â–∏–µ 6-7 –¥–Ω–µ–π - –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∑–∞—á–∞—Ç–∏—è.\n\n"
        "üìä –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —ç—Ç–∏ –¥–Ω–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞."
    ),

    NotificationType.OVULATION_DAY: (
        "üéØ –î–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏\n\n"
        "–°–µ–≥–æ–¥–Ω—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –¥–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏.\n"
        "–≠—Ç–æ –ø–∏–∫ –≤–∞—à–µ–π —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ç–µ–∫—É—â–µ–º —Ü–∏–∫–ª–µ.\n\n"
        "üå°Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–∑–∞–ª—å–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, "
        "–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ—Ä–≤–∏–∫–∞–ª—å–Ω–æ–π —Å–ª–∏–∑–∏, –ª–µ–≥–∫–∞—è –±–æ–ª—å –≤–Ω–∏–∑—É –∂–∏–≤–æ—Ç–∞."
    ),

    NotificationType.SAFE_PERIOD: (
        "‚úÖ –ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞\n\n"
        "–§–µ—Ä—Ç–∏–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å.\n"
        "–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∑–∞—á–∞—Ç–∏—è –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –¥–Ω–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞.\n\n"
        "üìù –ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ —ç—Ç–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã. "
        "–î–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–∞—Ü–µ–ø—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã."
    )
}


# –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
# –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–∑–Ω–∞—á–∞—é—Ç "–∑–∞ X –¥–Ω–µ–π –¥–æ —Å–æ–±—ã—Ç–∏—è"
# –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–∑–Ω–∞—á–∞—é—Ç "—á–µ—Ä–µ–∑ X –¥–Ω–µ–π –ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏—è"
NOTIFICATION_OFFSETS: Dict[NotificationType, timedelta] = {
    NotificationType.PERIOD_REMINDER: timedelta(days=-2),  # –ó–∞ 2 –¥–Ω—è –¥–æ –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö
    NotificationType.PERIOD_START: timedelta(days=0),  # –í –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö
    NotificationType.FERTILE_WINDOW_START: timedelta(days=0),  # –í –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    NotificationType.OVULATION_DAY: timedelta(days=0),  # –í –¥–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏
    NotificationType.SAFE_PERIOD: timedelta(days=0)  # –í –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
}


# –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–≤ —á–∞—Å–∞—Ö –∏ –º–∏–Ω—É—Ç–∞—Ö)
DEFAULT_NOTIFICATION_TIME = {
    'hour': 9,  # 9:00 —É—Ç—Ä–∞
    'minute': 0
}


def get_notification_message(notification_type: NotificationType) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

    Args:
        notification_type: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

    Returns:
        –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    """
    return NOTIFICATION_MESSAGES.get(
        notification_type,
        "üì¨ –£ –≤–∞—Å –µ—Å—Ç—å –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–∞—à–µ–º —Ü–∏–∫–ª–µ."
    )


def get_notification_offset(notification_type: NotificationType) -> timedelta:
    """
    –ü–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

    Args:
        notification_type: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

    Returns:
        –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–æ–±—ã—Ç–∏—è
    """
    return NOTIFICATION_OFFSETS.get(notification_type, timedelta(days=0))


def get_notification_display_name(notification_type: NotificationType) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

    Args:
        notification_type: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

    Returns:
        –ù–∞–∑–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    """
    display_names = {
        NotificationType.PERIOD_REMINDER: "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –º–µ—Å—è—á–Ω—ã—Ö (–∑–∞ 2 –¥–Ω—è)",
        NotificationType.PERIOD_START: "–ù–∞—á–∞–ª–æ –º–µ—Å—è—á–Ω—ã—Ö",
        NotificationType.FERTILE_WINDOW_START: "–ù–∞—á–∞–ª–æ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞",
        NotificationType.OVULATION_DAY: "–î–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏",
        NotificationType.SAFE_PERIOD: "–ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞"
    }
    return display_names.get(notification_type, "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ")


def get_notification_emoji(notification_type: NotificationType) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —ç–º–æ–¥–∑–∏ –¥–ª—è —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

    Args:
        notification_type: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

    Returns:
        –≠–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    """
    emojis = {
        NotificationType.PERIOD_REMINDER: "üîî",
        NotificationType.PERIOD_START: "ü©∏",
        NotificationType.FERTILE_WINDOW_START: "üå∏",
        NotificationType.OVULATION_DAY: "üéØ",
        NotificationType.SAFE_PERIOD: "‚úÖ"
    }
    return emojis.get(notification_type, "üì¨")


def get_all_notification_types() -> list[NotificationType]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

    Returns:
        –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    """
    return list(NotificationType)


def calculate_notification_datetime(event_date, notification_type: NotificationType,
                                   custom_time: Optional[Dict[str, int]] = None):
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

    Args:
        event_date: –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—á–∞–ª–æ –º–µ—Å—è—á–Ω—ã—Ö)
        notification_type: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        custom_time: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ {'hour': X, 'minute': Y}

    Returns:
        datetime –æ–±—ä–µ–∫—Ç —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    """
    from datetime import datetime, time

    # –ü–æ–ª—É—á–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    offset = get_notification_offset(notification_type)

    # –í—ã—á–∏—Å–ª—è–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–∫–∏
    notification_date = event_date + offset

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    notification_time_dict = custom_time or DEFAULT_NOTIFICATION_TIME
    notification_time = time(
        hour=notification_time_dict['hour'],
        minute=notification_time_dict['minute']
    )

    # –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
    return datetime.combine(notification_date, notification_time)